<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/commersant-registration-page/style.css">
</head>
<body>


<div class="form-wrapper">

    <form id="form"  method="post" class="form">

        <div class="input-group">
            <input class="input-field" name="bik" required>
            <label class="input-label"> БИК </label>
        </div>

        <div class="input-group">
            <input class="input-field" name="bin" required>
            <label class="input-label"> БИН </label>
        </div>

        <div class="input-group">
            <input class="input-field" name="kbe" required>
            <label class="input-label"> Кбе </label>
        </div>

        <div class="input-group">
            <input class="input-field" name="organizationName" required>
            <label class="input-label"> Название организации </label>
        </div>

        <div class="input-group">
            <input class="input-field" name="directorIdentityCard" required>
            <label class="input-label"> Номер удостоверения владельца </label>
        </div>

        <div class="input-group">
            <input class="input-field" name="directorName" required>
            <label class="input-label"> Имя владельца </label>
        </div>

        <div class="flex-row">
            <button type="reset" class="btn-reset"> Отменить</button>
            <button class="btn-submit" type="submit"> Отправить</button>
        </div>

    </form>
</div>

</body>

</html>

<script>

    let form = window['form'];
    let label = document.getElementsByClassName("input-label")[0];

    let url = 'http://localhost:8080/registration';

    form.addEventListener("submit", async function (e) {
        e.preventDefault();
        e.stopPropagation();

        //Отправляем форму оплаты с информацией о карте и покупателе
        let formData = new FormData(form);
        let transaction = Object.fromEntries(formData);
        console.log(transaction);

        let response = await fetch(url, {
            method: "post",
            headers: {"Content-Type": "application/json;charset=utf-8"},
            body: JSON.stringify(transaction)
        });

        let responseMessage = await response.text();

        if (responseMessage === 'Validation Successful') {
            form.hidden = true;
            let text = 'Регистрация прошла успешно';
            document.body.append(text);
        } else  {
            form.hidden = true;
            let text = responseMessage;
            document.body.append(text);
        }
    });

    form.addEventListener('click', function (e) {

        let input = e.target;
        if (input.nodeName === 'INPUT') {
            let label = input.nextElementSibling;

            input.style.background = 'white';
            label.style.top = '0';
            label.style.transition = '0.3s';
            input.style.boxShadow = 'inset 0 0 0 1px #616871';

            input.addEventListener('blur', function () {
                console.log(input.value);
                if (input.value !== '') {
                    hasValue();
                } else {
                    notValue()
                }
            });

            function hasValue() {
                label.style.top = '0';
                input.style.background = 'white';
                input.style.boxShadow = 'inset 0 0 0 1px #616871';
            }

            function notValue() {
                label.style.top = '10px';
                input.style.background = '#ecf1f7';
                input.style.boxShadow = null;
            }
        }

    });

</script>